<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proveedores - AgroTechNova</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../public/css/base.css">
  <style>
    /* Animaciones */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideOutRight {
      from {
        opacity: 1;
        transform: translateX(0);
      }
      to {
        opacity: 0;
        transform: translateX(100px);
      }
    }

    /* Estilos del modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: white;
      padding: 35px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-height: 90vh;
      overflow-y: auto;
      width: 100%;
    }

    /* Estilos de inputs con focus */
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea !important;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* Estilos para hover en inputs */
    input:hover, select:hover, textarea:hover {
      border-color: #b8c4ea;
    }

    /* Scrollbar personalizada */
    .modal-content::-webkit-scrollbar {
      width: 8px;
    }

    .modal-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .modal-content::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
    }

    /* Tabla responsive */
    @media (max-width: 768px) {
      table {
        font-size: 12px;
      }
      
      th, td {
        padding: 10px 8px !important;
      }
      
      .modal-content {
        padding: 20px;
      }
    }

    /* Efectos hover para botones cerrar modal */
    .modal-content button[onclick="cerrarModal()"]:hover {
      background: #ffebee !important;
      color: #e74c3c !important;
      transform: rotate(90deg);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header con navegaci√≥n unificada -->
    <header>
      <div class="header-content">
        <img src="../images/logo.png" alt="Logo AgroTechnova" class="logo">
        <h1>üè¢ Gesti√≥n de Proveedores</h1>
        <div class="user-info">
          <span id="userName">Usuario</span>
          <button onclick="cerrarSesion()" class="btn-logout">Cerrar Sesi√≥n</button>
        </div>
      </div>
      <nav>
        <a href="dashboard.html">Dashboard</a>
        <a href="proyectos.html">Proyectos</a>
        <a href="usuarios.html">Usuarios</a>
        <a href="agendaReuniones.html">Agenda</a>
        
        <!-- Dropdown: Gesti√≥n Financiera -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn">
            Gesti√≥n Financiera
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="nav-dropdown-content">
            <a href="recursos.html">Recursos</a>
            <a href="presupuestos.html">Presupuestos</a>
            <a href="gastos.html">Gastos</a>
          </div>
        </div>
        
        <!-- Dropdown: Inventario y Proveedores -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn active">
            Inventario y Proveedores
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="nav-dropdown-content">
            <a href="proveedores.html" class="active">Proveedores</a>
            <a href="productos.html">Productos</a>
            <a href="inventario.html">Inventario</a>
          </div>
        </div>

        <!-- Dropdown: Reportes y Documentaci√≥n -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn">
            Reportes y Documentaci√≥n
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="nav-dropdown-content">
            <a href="reportes.html">Reportes Financieros</a>
            <a href="proyectosFinalizados.html">Proyectos Finalizados</a>
            <a href="catalogo.html">Cat√°logo de Servicios</a>
          </div>
        </div>
      </nav>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <a href="dashboard.html">Dashboard</a>
      <span>‚Ä∫</span>
      <span>Proveedores</span>
    </div>

    <!-- Estad√≠sticas Modernas -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
      <!-- Total Proveedores -->
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; padding: 25px; color: white; box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden;">
        <div style="position: absolute; top: -20px; right: -20px; font-size: 100px; opacity: 0.1;">üè¢</div>
        <div style="position: relative; z-index: 1;">
          <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">Total Proveedores</div>
          <div style="font-size: 36px; font-weight: bold; margin-bottom: 8px;" id="totalProveedores">0</div>
          <div style="font-size: 12px; opacity: 0.8;">üìä Red de suministro</div>
        </div>
      </div>

      <!-- Activos -->
      <div style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); border-radius: 15px; padding: 25px; color: white; box-shadow: 0 8px 16px rgba(56, 239, 125, 0.3); position: relative; overflow: hidden;">
        <div style="position: absolute; top: -20px; right: -20px; font-size: 100px; opacity: 0.1;">‚úÖ</div>
        <div style="position: relative; z-index: 1;">
          <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">Activos</div>
          <div style="font-size: 36px; font-weight: bold; margin-bottom: 8px;" id="totalActivos">0</div>
          <div style="font-size: 12px; opacity: 0.8;">üü¢ Operativos</div>
        </div>
      </div>

      <!-- Inactivos -->
      <div style="background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%); border-radius: 15px; padding: 25px; color: white; box-shadow: 0 8px 16px rgba(255, 106, 0, 0.3); position: relative; overflow: hidden;">
        <div style="position: absolute; top: -20px; right: -20px; font-size: 100px; opacity: 0.1;">‚è∏Ô∏è</div>
        <div style="position: relative; z-index: 1;">
          <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px; font-weight: 500;">Inactivos</div>
          <div style="font-size: 36px; font-weight: bold; margin-bottom: 8px;" id="totalInactivos">0</div>
          <div style="font-size: 12px; opacity: 0.8;">üî¥ Suspendidos</div>
        </div>
      </div>
    </div>

    <!-- Botones de acci√≥n y b√∫squeda -->
    <section style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
      <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
        <button class="btn-primary" id="btnNuevoProveedor" style="display: flex; align-items: center; gap: 8px;">
          <i class="fas fa-plus-circle"></i> Nuevo Proveedor
        </button>
        <button class="btn btn-secondary" onclick="cargarProveedores()" style="display: flex; align-items: center; gap: 8px;">
          <i class="fas fa-sync-alt"></i> Actualizar
        </button>
        <div style="flex: 1; min-width: 250px; max-width: 400px;">
          <div style="position: relative;">
            <i class="fas fa-search" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #999;"></i>
            <input type="text" id="searchInput" placeholder="Buscar por nombre, NIT o tipo de productos..." 
                   style="width: 100%; padding: 12px 15px 12px 45px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; transition: all 0.3s;"
                   onkeyup="filtrarProveedores()">
          </div>
        </div>
      </div>
    </section>

    <!-- Modal para Nuevo/Editar Proveedor -->
    <div id="modalProveedor" class="modal" style="display: none;">
      <div class="modal-content" style="max-width: 700px; animation: slideDown 0.3s ease;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0;">
          <h2 id="formTitle" style="margin: 0; color: #2e7d32; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-building"></i> Nuevo Proveedor
          </h2>
          <button onclick="cerrarModal()" style="background: none; border: none; font-size: 28px; color: #999; cursor: pointer; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s;">&times;</button>
        </div>

        <form id="formProveedor">
          <div style="display: grid; gap: 20px;">
            <!-- Nombre del proveedor -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #667eea;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-building" style="color: #667eea;"></i> Nombre del proveedor *
              </label>
              <input type="text" id="nombre" required 
                     style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; transition: all 0.3s;"
                     placeholder="Ej: Agroqu√≠micos del Valle">
            </div>

            <!-- NIT y Contacto -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #11998e;">
                <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                  <i class="fas fa-id-card" style="color: #11998e;"></i> NIT
                </label>
                <input type="text" id="nit" 
                       style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                       placeholder="900123456-7">
              </div>

              <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #f093fb;">
                <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                  <i class="fas fa-user" style="color: #f093fb;"></i> Persona de contacto *
                </label>
                <input type="text" id="contacto" required 
                       style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                       placeholder="Carlos P√©rez">
              </div>
            </div>

            <!-- Tel√©fono y Correo -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #4facfe;">
                <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                  <i class="fas fa-phone" style="color: #4facfe;"></i> Tel√©fono *
                </label>
                <input type="tel" id="telefono" required 
                       style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                       placeholder="3001234567">
              </div>

              <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #fa709a;">
                <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                  <i class="fas fa-envelope" style="color: #fa709a;"></i> Correo electr√≥nico
                </label>
                <input type="email" id="correo" 
                       style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                       placeholder="contacto@agroquimicos.com">
              </div>
            </div>

            <!-- Direcci√≥n -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #feca57;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-map-marker-alt" style="color: #feca57;"></i> Direcci√≥n
              </label>
              <input type="text" id="direccion" 
                     style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                     placeholder="Calle 123 #45-67, Bogot√°">
            </div>

            <!-- Tipo de productos -->
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #48dbfb;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-boxes" style="color: #48dbfb;"></i> Tipo de productos que suministra *
              </label>
              <input type="text" id="tipo_productos" required 
                     style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                     placeholder="Ej: Fertilizantes y pesticidas">
            </div>

            <!-- Estado (solo al editar) -->
            <div id="estadoContainer" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #ee5a6f;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-toggle-on" style="color: #ee5a6f;"></i> Estado
              </label>
              <select id="estado" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white;">
                <option value="activo">Activo</option>
                <option value="inactivo">Inactivo</option>
              </select>
            </div>
          </div>

          <!-- Botones del formulario -->
          <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
            <button type="button" class="btn btn-secondary" onclick="cerrarModal()" style="display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-times"></i> Cancelar
            </button>
            <button type="submit" class="btn btn-primary" style="display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-save"></i> Guardar Proveedor
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Tabla de proveedores con dise√±o mejorado -->
    <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.08);">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0; color: #2e7d32; display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-list"></i> Listado de Proveedores
        </h2>
        <span id="contadorProveedores" style="background: #e8f5e9; color: #2e7d32; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 14px;">
          0 proveedores
        </span>
      </div>
      
      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: separate; border-spacing: 0;">
          <thead>
            <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
              <th style="padding: 15px; text-align: left; font-weight: 600; border-top-left-radius: 10px;">
                <i class="fas fa-building"></i> Nombre
              </th>
              <th style="padding: 15px; text-align: left; font-weight: 600;">
                <i class="fas fa-id-card"></i> NIT
              </th>
              <th style="padding: 15px; text-align: left; font-weight: 600;">
                <i class="fas fa-user"></i> Contacto
              </th>
              <th style="padding: 15px; text-align: left; font-weight: 600;">
                <i class="fas fa-phone"></i> Tel√©fono
              </th>
              <th style="padding: 15px; text-align: left; font-weight: 600;">
                <i class="fas fa-envelope"></i> Correo
              </th>
              <th style="padding: 15px; text-align: left; font-weight: 600;">
                <i class="fas fa-boxes"></i> Tipo Productos
              </th>
              <th style="padding: 15px; text-align: center; font-weight: 600;">
                <i class="fas fa-toggle-on"></i> Estado
              </th>
              <th style="padding: 15px; text-align: center; font-weight: 600; border-top-right-radius: 10px;">
                <i class="fas fa-cog"></i> Acciones
              </th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr>
              <td colspan="8" style="text-align: center; padding: 40px; color: #999;">
                <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i>
                <div>Cargando proveedores...</div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Bot√≥n oculto para logout -->
  <form id="logoutForm" method="POST" action="/api/auth/logout" style="display: none;">
    <button id="logoutBtn" type="submit"></button>
  </form>

  <script>
    let proveedorEditando = null;

    // Verificar sesi√≥n al cargar
    async function verificarSesion() {
      try {
        const response = await fetch('/api/auth/session');
        if (!response.ok) {
          window.location.href = '/login.html';
          return false;
        }
        const data = await response.json();
        document.getElementById('userName').textContent = data.user.nombre;
        return true;
      } catch (error) {
        window.location.href = '/login.html';
        return false;
      }
    }

    // Cerrar sesi√≥n
    async function cerrarSesion() {
      try {
        await fetch('/api/auth/logout', { method: 'POST' });
        window.location.href = '/login.html';
      } catch (error) {
        window.location.href = '/login.html';
      }
    }

    // Variable global para almacenar todos los proveedores
    let todosLosProveedores = [];

    // Cargar proveedores
    async function cargarProveedores() {
      try {
        const response = await fetch('/api/providers');
        const data = await response.json();
        
        todosLosProveedores = data.providers || [];
        mostrarProveedores(todosLosProveedores);
        actualizarEstadisticas(todosLosProveedores);
      } catch (error) {
        console.error('Error al cargar proveedores:', error);
        const tbody = document.getElementById('tbody');
        tbody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; padding: 40px; color: #e74c3c;">
              <i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 10px;"></i>
              <div>Error al cargar proveedores</div>
            </td>
          </tr>
        `;
      }
    }

    // Mostrar proveedores en la tabla
    function mostrarProveedores(proveedores) {
      const tbody = document.getElementById('tbody');
      const contador = document.getElementById('contadorProveedores');
      
      contador.textContent = `${proveedores.length} proveedor${proveedores.length !== 1 ? 'es' : ''}`;
      
      if (!proveedores || proveedores.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; padding: 40px; color: #999;">
              <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px; opacity: 0.3;"></i>
              <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">No hay proveedores registrados</div>
              <div style="font-size: 14px;">Haz clic en "Nuevo Proveedor" para comenzar</div>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = proveedores.map((proveedor, index) => {
        const estadoBadge = proveedor.estado === 'activo' 
          ? '<span style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; display: inline-flex; align-items: center; gap: 5px;"><i class="fas fa-check-circle"></i> Activo</span>'
          : '<span style="background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%); color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; display: inline-flex; align-items: center; gap: 5px;"><i class="fas fa-pause-circle"></i> Inactivo</span>';
        
        const rowStyle = index % 2 === 0 ? 'background: #f8f9fa;' : 'background: white;';
        
        return `
          <tr style="${rowStyle} transition: all 0.3s; border-left: 4px solid transparent;" 
              onmouseover="this.style.background='#e8f5e9'; this.style.borderLeftColor='#4caf50'; this.style.transform='scale(1.01)';" 
              onmouseout="this.style.background='${index % 2 === 0 ? '#f8f9fa' : 'white'}'; this.style.borderLeftColor='transparent'; this.style.transform='scale(1)';">
            <td style="padding: 18px 15px; font-weight: 600; color: #333;">
              <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 16px;">
                  ${proveedor.nombre.charAt(0).toUpperCase()}
                </div>
                <span>${proveedor.nombre}</span>
              </div>
            </td>
            <td style="padding: 18px 15px; color: #666; font-family: monospace;">${proveedor.nit || '<span style="color: #ccc;">N/A</span>'}</td>
            <td style="padding: 18px 15px; color: #666;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-user-circle" style="color: #f093fb;"></i>
                ${proveedor.contacto || '<span style="color: #ccc;">N/A</span>'}
              </div>
            </td>
            <td style="padding: 18px 15px; color: #666;">
              <div style="display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-phone" style="color: #4facfe;"></i>
                ${proveedor.telefono || '<span style="color: #ccc;">N/A</span>'}
              </div>
            </td>
            <td style="padding: 18px 15px; color: #666;">
              ${proveedor.correo ? `<a href="mailto:${proveedor.correo}" style="color: #667eea; text-decoration: none; display: flex; align-items: center; gap: 8px;"><i class="fas fa-envelope"></i> ${proveedor.correo}</a>` : '<span style="color: #ccc;">N/A</span>'}
            </td>
            <td style="padding: 18px 15px; color: #666;">
              <div style="display: inline-block; background: #e3f2fd; color: #1976d2; padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 500;">
                <i class="fas fa-box"></i> ${proveedor.tipo_productos || '<span style="color: #ccc;">N/A</span>'}
              </div>
            </td>
            <td style="padding: 18px 15px; text-align: center;">${estadoBadge}</td>
            <td style="padding: 18px 15px; text-align: center;">
              <div style="display: flex; gap: 8px; justify-content: center;">
                <button onclick="editarProveedor(${proveedor.id})" 
                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; transition: all 0.3s;"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.4)';"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                  <i class="fas fa-edit"></i> Editar
                </button>
                <button onclick="toggleEstado(${proveedor.id}, '${proveedor.estado}')" 
                        style="background: ${proveedor.estado === 'activo' ? 'linear-gradient(135deg, #ee0979 0%, #ff6a00 100%)' : 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)'}; color: white; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; transition: all 0.3s;"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.2)';"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                  <i class="fas fa-${proveedor.estado === 'activo' ? 'ban' : 'check'}"></i> 
                  ${proveedor.estado === 'activo' ? 'Desactivar' : 'Activar'}
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    // Filtrar proveedores
    function filtrarProveedores() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
      
      if (!searchTerm) {
        mostrarProveedores(todosLosProveedores);
        return;
      }

      const proveedoresFiltrados = todosLosProveedores.filter(proveedor => {
        return (
          proveedor.nombre.toLowerCase().includes(searchTerm) ||
          (proveedor.nit && proveedor.nit.toLowerCase().includes(searchTerm)) ||
          (proveedor.tipo_productos && proveedor.tipo_productos.toLowerCase().includes(searchTerm)) ||
          (proveedor.contacto && proveedor.contacto.toLowerCase().includes(searchTerm))
        );
      });

      mostrarProveedores(proveedoresFiltrados);
    }

    // Actualizar estad√≠sticas
    function actualizarEstadisticas(proveedores) {
      document.getElementById('totalProveedores').textContent = proveedores.length;
      document.getElementById('totalActivos').textContent = proveedores.filter(p => p.estado === 'activo').length;
      document.getElementById('totalInactivos').textContent = proveedores.filter(p => p.estado === 'inactivo').length;
    }

    // Abrir modal para nuevo proveedor
    document.getElementById('btnNuevoProveedor').addEventListener('click', () => {
      proveedorEditando = null;
      document.getElementById('formTitle').innerHTML = '<i class="fas fa-plus-circle"></i> Nuevo Proveedor';
      document.getElementById('formProveedor').reset();
      document.getElementById('estadoContainer').style.display = 'none';
      document.getElementById('modalProveedor').style.display = 'flex';
    });

    // Cerrar modal
    function cerrarModal() {
      document.getElementById('modalProveedor').style.display = 'none';
      document.getElementById('formProveedor').reset();
      proveedorEditando = null;
    }

    // Cerrar modal al hacer clic fuera de √©l
    window.onclick = function(event) {
      const modal = document.getElementById('modalProveedor');
      if (event.target === modal) {
        cerrarModal();
      }
    };

    // Guardar proveedor
    document.getElementById('formProveedor').addEventListener('submit', async (e) => {
      e.preventDefault();

      const btnSubmit = e.target.querySelector('button[type="submit"]');
      const textoOriginal = btnSubmit.innerHTML;
      btnSubmit.disabled = true;
      btnSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';

      const proveedor = {
        nombre: document.getElementById('nombre').value.trim(),
        nit: document.getElementById('nit').value.trim(),
        contacto: document.getElementById('contacto').value.trim(),
        telefono: document.getElementById('telefono').value.trim(),
        correo: document.getElementById('correo').value.trim(),
        direccion: document.getElementById('direccion').value.trim(),
        tipo_productos: document.getElementById('tipo_productos').value.trim()
      };

      if (proveedorEditando) {
        proveedor.estado = document.getElementById('estado').value;
      }

      try {
        const url = proveedorEditando ? `/api/providers/${proveedorEditando}` : '/api/providers';
        const method = proveedorEditando ? 'PUT' : 'POST';

        const response = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(proveedor)
        });

        const data = await response.json();

        if (response.ok) {
          mostrarNotificacion(data.message || 'Proveedor guardado exitosamente', 'success');
          cerrarModal();
          await cargarProveedores();
        } else {
          mostrarNotificacion(data.message || 'Error al guardar proveedor', 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        mostrarNotificacion('Error al guardar proveedor', 'error');
      } finally {
        btnSubmit.disabled = false;
        btnSubmit.innerHTML = textoOriginal;
      }
    });

    // Funci√≥n para mostrar notificaciones
    function mostrarNotificacion(mensaje, tipo) {
      const notificacion = document.createElement('div');
      const icono = tipo === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
      const color = tipo === 'success' ? 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)' : 'linear-gradient(135deg, #ee0979 0%, #ff6a00 100%)';
      
      notificacion.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${color};
        color: white;
        padding: 18px 24px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 600;
        animation: slideInRight 0.4s ease;
        max-width: 400px;
      `;
      
      notificacion.innerHTML = `
        <i class="fas ${icono}" style="font-size: 20px;"></i>
        <span>${mensaje}</span>
      `;
      
      document.body.appendChild(notificacion);
      
      setTimeout(() => {
        notificacion.style.animation = 'slideOutRight 0.4s ease';
        setTimeout(() => notificacion.remove(), 400);
      }, 3000);
    }

    // Editar proveedor
    async function editarProveedor(id) {
      try {
        const response = await fetch(`/api/providers/${id}`);
        const data = await response.json();

        if (response.ok && data.provider) {
          proveedorEditando = id;
          document.getElementById('formTitle').innerHTML = '<i class="fas fa-edit"></i> Editar Proveedor';
          document.getElementById('nombre').value = data.provider.nombre;
          document.getElementById('nit').value = data.provider.nit || '';
          document.getElementById('contacto').value = data.provider.contacto || '';
          document.getElementById('telefono').value = data.provider.telefono || '';
          document.getElementById('correo').value = data.provider.correo || '';
          document.getElementById('direccion').value = data.provider.direccion || '';
          document.getElementById('tipo_productos').value = data.provider.tipo_productos || '';
          document.getElementById('estado').value = data.provider.estado;
          document.getElementById('estadoContainer').style.display = 'block';
          document.getElementById('modalProveedor').style.display = 'flex';
        }
      } catch (error) {
        console.error('Error:', error);
        mostrarNotificacion('Error al cargar proveedor', 'error');
      }
    }

    // Cambiar estado del proveedor
    async function toggleEstado(id, estadoActual) {
      const nuevoEstado = estadoActual === 'activo' ? 'inactivo' : 'activo';
      const accion = nuevoEstado === 'activo' ? 'activate' : 'deactivate';
      const textoAccion = accion === 'activate' ? 'activar' : 'desactivar';
      
      // Confirmaci√≥n moderna
      const confirmacion = confirm(`¬øEst√° seguro de ${textoAccion} este proveedor?\n\nEsto cambiar√° su disponibilidad en el sistema.`);
      if (!confirmacion) return;

      try {
        const response = await fetch(`/api/providers/${id}/${accion}`, {
          method: 'PATCH'
        });

        const data = await response.json();

        if (response.ok) {
          mostrarNotificacion(`Proveedor ${textoAccion === 'activar' ? 'activado' : 'desactivado'} exitosamente`, 'success');
          await cargarProveedores();
        } else {
          mostrarNotificacion(data.message || 'Error al cambiar estado', 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        mostrarNotificacion('Error al cambiar estado del proveedor', 'error');
      }
    }

    // Inicializar
    window.onload = async () => {
      if (await verificarSesion()) {
        await cargarProveedores();
      }
    };

    // Manejo del logout
    document.getElementById('logoutForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        await fetch('/api/auth/logout', { method: 'POST' });
        window.location.href = '/login.html';
      } catch (error) {
        window.location.href = '/login.html';
      }
    });

    // Funcionalidad de dropdowns
    document.addEventListener('DOMContentLoaded', function() {
      const dropdownButtons = document.querySelectorAll('.nav-dropdown-btn');
      
      dropdownButtons.forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const dropdown = this.parentElement;
          const isOpen = dropdown.classList.contains('open');
          
          // Cerrar todos los dropdowns
          document.querySelectorAll('.nav-dropdown').forEach(dd => {
            dd.classList.remove('open');
          });
          
          // Abrir/cerrar el dropdown actual
          if (!isOpen) {
            dropdown.classList.add('open');
          }
        });
      });
      
      // Cerrar dropdowns al hacer clic fuera
      document.addEventListener('click', function() {
        document.querySelectorAll('.nav-dropdown').forEach(dd => {
          dd.classList.remove('open');
        });
      });
    });
  </script>
</body>
</html>
