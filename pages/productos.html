<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Productos - AgroTechNova</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../public/css/base.css">

</head>
<body>
  <div class="container">
        <!-- Header con navegaci√≥n unificada -->
    <header>
      <div class="header-content">
        <img src="../images/logo.png" alt="Logo AgroTechnova" class="logo">
        <h1>üì¶ Cat√°logo de Productos</h1>
        <div class="user-info">
          <span id="usuarioNombre">Administrador</span>
          <button onclick="cerrarSesion()" class="btn-logout">Cerrar Sesi√≥n</button>
        </div>
      </div>
      <nav>
        <a href="dashboard.html">Dashboard</a>
        <a href="proyectos.html">Proyectos</a>
        <a href="usuarios.html">Usuarios</a>
        <a href="agendaReuniones.html">Agenda</a>
        
        <!-- Dropdown: Gesti√≥n Financiera -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn">
            Gesti√≥n Financiera
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="nav-dropdown-content">
            <a href="recursos.html">Recursos</a>
            <a href="presupuestos.html">Presupuestos</a>
            <a href="gastos.html">Gastos</a>
          </div>
        </div>
        
        <!-- Dropdown: Inventario y Proveedores -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn active">
            Inventario y Proveedores
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="nav-dropdown-content">
            <a href="proveedores.html">Proveedores</a>
            <a href="productos.html" class="active">Productos</a>
            <a href="inventario.html">Inventario</a>
          </div>
        </div>

        <!-- Dropdown: Reportes y Documentaci√≥n -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn">
            Reportes y Documentaci√≥n
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="nav-dropdown-content">
            <a href="reportes.html">Reportes Financieros</a>
            <a href="proyectosFinalizados.html">Proyectos Finalizados</a>
            <a href="catalogo.html">Cat√°logo de Servicios</a>
          </div>
        </div>
      </nav>
    </header>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <a href="dashboard.html">Dashboard</a>
      <span>‚Ä∫</span>
      <span>Productos</span>
    </div>

    <!-- Estad√≠sticas -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
      <div class="stats-card">
        <div class="stats-icon" style="background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);">üì¶</div>
        <div class="stats-info">
          <div class="stats-value" id="totalProductos">0</div>
          <div class="stats-label">Total Productos</div>
        </div>
      </div>
      <div class="stats-card">
        <div class="stats-icon" style="background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%);">üí∞</div>
        <div class="stats-info">
          <div class="stats-value" id="valorInventario">$0</div>
          <div class="stats-label">Valor Inventario</div>
        </div>
      </div>
      <div class="stats-card">
        <div class="stats-icon" style="background: linear-gradient(135deg, #f57c00 0%, #ff9800 100%);">‚ö†Ô∏è</div>
        <div class="stats-info">
          <div class="stats-value" id="productosStockBajo">0</div>
          <div class="stats-label">Stock Bajo</div>
        </div>
      </div>
    </div>

    <!-- Filtros y Bot√≥n Crear -->
    <section style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button onclick="filtrarProductos('todos')" id="btnTodos" class="filter-btn active">Todos</button>
          <button onclick="filtrarProductos('organicos')" id="btnOrganicos" class="filter-btn">üå± Org√°nicos</button>
          <button onclick="filtrarProductos('stock_bajo')" id="btnStockBajo" class="filter-btn">‚ö†Ô∏è Stock Bajo</button>
          <select id="filtroProveedor" onchange="filtrarPorProveedor()" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
            <option value="">Todos los proveedores</option>
          </select>
        </div>
        <button class="btn-primary" onclick="abrirModalCrear()">‚ûï Nuevo Producto</button>
      </div>
    </section>

    <!-- Mensaje de feedback -->
    <div id="mensaje" style="display: none; padding: 15px; border-radius: 5px; margin-bottom: 20px;"></div>

    <!-- Tabla de Productos -->
    <section style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h2 style="color: #2e7d32; margin-bottom: 20px;">üìã Inventario de Productos</h2>
      
      <div id="loader" style="text-align: center; padding: 40px; color: #666;">
        Cargando productos...
      </div>

      <table id="tabla-productos" style="display: none; width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%); color: white;">
            <th style="padding: 12px; text-align: left;">ID</th>
            <th style="padding: 12px; text-align: left;">Nombre</th>
            <th style="padding: 12px; text-align: left;">Tipo</th>
            <th style="padding: 12px; text-align: left;">Categor√≠a</th>
            <th style="padding: 12px; text-align: center;">Stock Actual</th>
            <th style="padding: 12px; text-align: center;">Stock M√≠n.</th>
            <th style="padding: 12px; text-align: right;">Costo Unit.</th>
            <th style="padding: 12px; text-align: left;">Proveedor</th>
            <th style="padding: 12px; text-align: center;">Tipo</th>
            <th style="padding: 12px; text-align: center;">Acciones</th>
          </tr>
        </thead>
        <tbody id="productos-body"></tbody>
      </table>
    </section>
  </div>

  <!-- Modal Crear/Editar Producto -->
  <div id="modalProducto" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0;">
        <h2 id="modalTitle" style="margin: 0; color: #2e7d32; display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-box-open"></i> Nuevo Producto
        </h2>
        <button onclick="cerrarModal()" style="background: none; border: none; font-size: 28px; color: #999; cursor: pointer; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s;">&times;</button>
      </div>

      <form id="formProducto">
        <input type="hidden" id="producto_id">
        
        <div style="display: grid; gap: 20px;">
          <!-- Nombre y Tipo -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #4CAF50;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-tag" style="color: #4CAF50;"></i> Nombre del producto *
              </label>
              <input type="text" id="nombre" required 
                     style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                     placeholder="Ej: Fertilizante NPK 10-30-10">
            </div>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #2196F3;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-layer-group" style="color: #2196F3;"></i> Tipo *
              </label>
              <select id="tipo" required 
                      style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white;">
                <option value="">Seleccione...</option>
                <option value="insumo">Insumo</option>
                <option value="herramienta">Herramienta</option>
                <option value="equipo">Equipo</option>
                <option value="semilla">Semilla</option>
                <option value="fertilizante">Fertilizante</option>
                <option value="pesticida">Pesticida</option>
                <option value="materia_prima">Materia Prima</option>
                <option value="otro">Otro</option>
              </select>
            </div>
          </div>

          <!-- Categor√≠a y Unidad -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #FF9800;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-folder" style="color: #FF9800;"></i> Categor√≠a
              </label>
              <input type="text" id="categoria" 
                     style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                     placeholder="Ej: Fertilizantes, Semillas...">
            </div>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #9C27B0;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-balance-scale" style="color: #9C27B0;"></i> Unidad de medida *
              </label>
              <input type="text" id="unidad" required 
                     style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                     placeholder="kg, litros, unidades...">
            </div>
          </div>

          <!-- Stock Actual y M√≠nimo -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #00BCD4;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-cubes" style="color: #00BCD4;"></i> Stock actual
              </label>
              <input type="number" id="stock_actual" min="0" value="0" step="0.01"
                     style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
            </div>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #FF5722;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-chart-line" style="color: #FF5722;"></i> Stock m√≠nimo *
              </label>
              <input type="number" id="stock_minimo" min="0" value="5" step="0.01" required 
                     style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;">
            </div>
          </div>

          <!-- Costo y Proveedor -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #4CAF50;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-dollar-sign" style="color: #4CAF50;"></i> Costo unitario *
              </label>
              <input type="number" id="costo_unitario" min="0" step="0.01" required 
                     style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;"
                     placeholder="0.00">
            </div>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid #607D8B;">
              <label style="display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px;">
                <i class="fas fa-truck" style="color: #607D8B;"></i> Proveedor
              </label>
              <select id="proveedor_id" 
                      style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; background: white;">
                <option value="">Sin proveedor</option>
              </select>
            </div>
          </div>

          <!-- Checkbox Org√°nico -->
          <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; border-left: 4px solid #4CAF50;">
            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
              <input type="checkbox" id="es_organico" 
                     style="width: 20px; height: 20px; cursor: pointer;">
              <span style="font-weight: 600; color: #2e7d32;">
                <i class="fas fa-leaf"></i> Producto org√°nico certificado
              </span>
            </label>
          </div>
        </div>

        <!-- Botones del formulario -->
        <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
          <button type="button" onclick="cerrarModal()" class="btn-secondary" style="display: flex; align-items: center; gap: 8px;">
            <i class="fas fa-times"></i> Cancelar
          </button>
          <button type="submit" class="btn-primary" style="display: flex; align-items: center; gap: 8px;">
            <i class="fas fa-save"></i> Guardar Producto
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let productos = [];
    let proveedores = [];
    let filtroActivo = 'todos';
    let modoEdicion = false;

    // Cargar nombre de usuario
    document.addEventListener('DOMContentLoaded', () => {
      const nombreUsuario = localStorage.getItem('nombreUsuario') || 'Usuario';
      document.getElementById('usuarioNombre').textContent = nombreUsuario;
      cargarDatos();
    });

    // Cerrar sesi√≥n
    function cerrarSesion() {
      fetch('/api/auth/logout', {
        method: 'POST',
        credentials: 'include'
      }).then(() => {
        localStorage.clear();
        window.location.href = 'login.html';
      });
    }

    // Cargar datos iniciales
    async function cargarDatos() {
      await Promise.all([
        cargarProductos(),
        cargarProveedores(),
        cargarEstadisticas()
      ]);
    }

    // Cargar proveedores
    async function cargarProveedores() {
      try {
        const response = await fetch('/api/providers/active', { credentials: 'include' });
        const data = await response.json();

        if (data.success) {
          proveedores = data.providers;
          
          // Llenar select de proveedores en modal
          const selectModal = document.getElementById('proveedor_id');
          selectModal.innerHTML = '<option value="">Sin proveedor</option>';
          proveedores.forEach(p => {
            selectModal.innerHTML += `<option value="${p.id}">${p.nombre}</option>`;
          });

          // Llenar select de filtro
          const selectFiltro = document.getElementById('filtroProveedor');
          selectFiltro.innerHTML = '<option value="">Todos los proveedores</option>';
          proveedores.forEach(p => {
            selectFiltro.innerHTML += `<option value="${p.id}">${p.nombre}</option>`;
          });
        }
      } catch (error) {
        console.error('Error cargando proveedores:', error);
      }
    }

    // Cargar productos
    async function cargarProductos() {
      try {
        const response = await fetch('/api/products', { credentials: 'include' });
        const data = await response.json();

        if (data.success) {
          productos = data.products;
          renderProductos();
          document.getElementById('loader').style.display = 'none';
          document.getElementById('tabla-productos').style.display = 'table';
        }
      } catch (error) {
        console.error('Error cargando productos:', error);
        mostrarMensaje('Error al cargar productos', 'error');
      }
    }

    // Cargar estad√≠sticas
    async function cargarEstadisticas() {
      try {
        // Total productos
        const respProductos = await fetch('/api/products', { credentials: 'include' });
        const dataProductos = await respProductos.json();
        document.getElementById('totalProductos').textContent = dataProductos.products?.length || 0;

        // Valor inventario
        const respValor = await fetch('/api/products/total-value', { credentials: 'include' });
        const dataValor = await respValor.json();
        if (dataValor.success) {
          document.getElementById('valorInventario').textContent = 
            `$${dataValor.totalValue.toLocaleString('es-CO')}`;
        }

        // Stock bajo
        const respStockBajo = await fetch('/api/products/low-stock', { credentials: 'include' });
        const dataStockBajo = await respStockBajo.json();
        document.getElementById('productosStockBajo').textContent = dataStockBajo.products?.length || 0;
      } catch (error) {
        console.error('Error cargando estad√≠sticas:', error);
      }
    }

    // Renderizar tabla de productos
    function renderProductos() {
      const tbody = document.getElementById('productos-body');
      tbody.innerHTML = '';

      let productosFiltrados = productos;

      // Aplicar filtros
      if (filtroActivo === 'organicos') {
        productosFiltrados = productos.filter(p => p.es_organico === 1);
      } else if (filtroActivo === 'stock_bajo') {
        productosFiltrados = productos.filter(p => p.stock_actual <= p.stock_minimo);
      }

      // Filtro por proveedor
      const proveedorSeleccionado = document.getElementById('filtroProveedor').value;
      if (proveedorSeleccionado) {
        productosFiltrados = productosFiltrados.filter(p => p.proveedor_id == proveedorSeleccionado);
      }

      productosFiltrados.forEach(producto => {
        const tr = document.createElement('tr');
        const proveedor = proveedores.find(prov => prov.id === producto.proveedor_id);
        const stockBajo = producto.stock_actual <= producto.stock_minimo;
        
        // Agregar clase si stock bajo
        if (stockBajo) {
          tr.className = 'stock-bajo';
        }
        
        const tipoBadge = producto.es_organico === 1
          ? '<span class="badge-organico">üå± Org√°nico</span>'
          : '<span class="badge-quimico">‚öóÔ∏è Qu√≠mico</span>';

        const stockStyle = stockBajo ? 'color: #f44336; font-weight: bold;' : '';

        tr.innerHTML = `
          <td style="padding: 12px;">${producto.id}</td>
          <td style="padding: 12px; font-weight: bold;">${producto.nombre}</td>
          <td style="padding: 12px;">${producto.tipo}</td>
          <td style="padding: 12px;">${producto.categoria || '-'}</td>
          <td style="padding: 12px; text-align: center; ${stockStyle}">${producto.stock_actual} ${producto.unidad}</td>
          <td style="padding: 12px; text-align: center;">${producto.stock_minimo} ${producto.unidad}</td>
          <td style="padding: 12px; text-align: right;">$${producto.costo_unitario.toLocaleString('es-CO')}</td>
          <td style="padding: 12px;">${proveedor ? proveedor.nombre : 'Sin proveedor'}</td>
          <td style="padding: 12px; text-align: center;">${tipoBadge}</td>
          <td style="padding: 12px; text-align: center;">
            <button onclick="editarProducto(${producto.id})" class="btn-action btn-edit" title="Editar">‚úèÔ∏è</button>
            <button onclick="eliminarProducto(${producto.id})" class="btn-action btn-delete" title="Eliminar">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      if (productosFiltrados.length === 0) {
        tbody.innerHTML = '<tr><td colspan="10" style="padding: 20px; text-align: center; color: #666;">No hay productos para mostrar</td></tr>';
      }
    }

    // Filtrar productos
    function filtrarProductos(tipo) {
      filtroActivo = tipo;
      
      // Actualizar botones
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(`btn${tipo.charAt(0).toUpperCase() + tipo.slice(1).replace('_', '')}`).classList.add('active');
      
      renderProductos();
    }

    // Filtrar por proveedor
    function filtrarPorProveedor() {
      renderProductos();
    }

    // Abrir modal para crear
    function abrirModalCrear() {
      modoEdicion = false;
      document.getElementById('modalTitle').textContent = 'Nuevo Producto';
      document.getElementById('formProducto').reset();
      document.getElementById('producto_id').value = '';
      document.getElementById('stock_actual').value = '0';
      document.getElementById('stock_minimo').value = '5';
      document.getElementById('modalProducto').style.display = 'flex';
    }

    // Cerrar modal
    function cerrarModal() {
      document.getElementById('modalProducto').style.display = 'none';
    }

    // Editar producto
    function editarProducto(id) {
      const producto = productos.find(p => p.id === id);
      if (!producto) return;

      modoEdicion = true;
      document.getElementById('modalTitle').textContent = 'Editar Producto';
      document.getElementById('producto_id').value = producto.id;
      document.getElementById('nombre').value = producto.nombre;
      document.getElementById('tipo').value = producto.tipo;
      document.getElementById('categoria').value = producto.categoria || '';
      document.getElementById('unidad').value = producto.unidad;
      document.getElementById('stock_actual').value = producto.stock_actual;
      document.getElementById('stock_minimo').value = producto.stock_minimo;
      document.getElementById('costo_unitario').value = producto.costo_unitario;
      document.getElementById('proveedor_id').value = producto.proveedor_id || '';
      document.getElementById('es_organico').checked = producto.es_organico === 1;
      document.getElementById('modalProducto').style.display = 'flex';
    }

    // Guardar producto
    document.getElementById('formProducto').addEventListener('submit', async (e) => {
      e.preventDefault();

      const data = {
        nombre: document.getElementById('nombre').value,
        tipo: document.getElementById('tipo').value,
        categoria: document.getElementById('categoria').value,
        unidad: document.getElementById('unidad').value,
        stock_actual: parseFloat(document.getElementById('stock_actual').value),
        stock_minimo: parseFloat(document.getElementById('stock_minimo').value),
        costo_unitario: parseFloat(document.getElementById('costo_unitario').value),
        proveedor_id: document.getElementById('proveedor_id').value || null,
        es_organico: document.getElementById('es_organico').checked ? 1 : 0
      };

      try {
        let response;
        if (modoEdicion) {
          const id = document.getElementById('producto_id').value;
          response = await fetch(`/api/products/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
            credentials: 'include'
          });
        } else {
          response = await fetch('/api/products', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
            credentials: 'include'
          });
        }

        const result = await response.json();

        if (result.success) {
          mostrarMensaje(result.message, 'success');
          cerrarModal();
          cargarDatos();
        } else {
          mostrarMensaje(result.message, 'error');
        }
      } catch (error) {
        console.error('Error guardando producto:', error);
        mostrarMensaje('Error al guardar producto', 'error');
      }
    });

    // Eliminar producto
    async function eliminarProducto(id) {
      if (!confirm('¬øEst√° seguro de eliminar este producto? Esta acci√≥n no se puede deshacer.')) return;

      try {
        const response = await fetch(`/api/products/${id}`, {
          method: 'DELETE',
          credentials: 'include'
        });

        const result = await response.json();
        if (result.success) {
          mostrarMensaje(result.message, 'success');
          cargarDatos();
        } else {
          mostrarMensaje(result.message, 'error');
        }
      } catch (error) {
        console.error('Error eliminando producto:', error);
        mostrarMensaje('Error al eliminar producto', 'error');
      }
    }

    // Mostrar mensaje
    function mostrarMensaje(texto, tipo) {
      const mensaje = document.getElementById('mensaje');
      mensaje.textContent = texto;
      mensaje.style.display = 'block';
      
      if (tipo === 'success') {
        mensaje.style.background = '#e8f5e9';
        mensaje.style.color = '#2e7d32';
        mensaje.style.border = '1px solid #4caf50';
      } else {
        mensaje.style.background = '#ffebee';
        mensaje.style.color = '#c62828';
        mensaje.style.border = '1px solid #f44336';
      }

      setTimeout(() => {
        mensaje.style.display = 'none';
      }, 5000);
    }

    // Cerrar modal al hacer clic fuera
    window.onclick = function(event) {
      const modal = document.getElementById('modalProducto');
      if (event.target === modal) {
        cerrarModal();
      }
    }

    // Funcionalidad de dropdowns
    document.addEventListener('DOMContentLoaded', function() {
      const dropdownButtons = document.querySelectorAll('.nav-dropdown-btn');
      
      dropdownButtons.forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const dropdown = this.parentElement;
          const isOpen = dropdown.classList.contains('open');
          
          // Cerrar todos los dropdowns
          document.querySelectorAll('.nav-dropdown').forEach(dd => {
            dd.classList.remove('open');
          });
          
          // Abrir/cerrar el dropdown actual
          if (!isOpen) {
            dropdown.classList.add('open');
          }
        });
      });
      
      // Cerrar dropdowns al hacer clic fuera
      document.addEventListener('click', function() {
        document.querySelectorAll('.nav-dropdown').forEach(dd => {
          dd.classList.remove('open');
        });
      });
    });
  </script>

  <style>
    /* Botones de filtro */
    .filter-btn {
      padding: 10px 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: white;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
      font-size: 14px;
    }

    .filter-btn:hover {
      background: #f5f5f5;
      border-color: #4caf50;
      transform: translateY(-1px);
    }

    .filter-btn.active {
      background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
      color: white;
      border-color: #2e7d32;
      box-shadow: 0 2px 8px rgba(46, 125, 50, 0.3);
    }

    /* Badges para tipo de producto */
    .badge-organico {
      background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-quimico {
      background: linear-gradient(135deg, #ff9800 0%, #ffa726 100%);
      color: white;
      padding: 4px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* Fila con stock bajo */
    .stock-bajo {
      background-color: #fff3cd !important;
      border-left: 4px solid #ff9800;
    }

    /* Mejorar tabla */
    #tabla-productos tbody tr {
      transition: all 0.2s;
    }

    #tabla-productos tbody tr:hover {
      background: #f5f5f5;
      transform: translateX(2px);
    }

    /* Loader mejorado */
    #loader {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    #loader::before {
      content: "‚è≥";
      font-size: 48px;
      animation: rotate 2s linear infinite;
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Secci√≥n de filtros */
    .filter-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .filter-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    /* Select mejorado */
    select {
      transition: all 0.3s;
    }

    select:focus {
      border-color: #4caf50;
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
      outline: none;
    }
  </style>
</html>






