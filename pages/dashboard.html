<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Principal - AgroTechNova</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="../public/css/base.css">
</head>
<body>

  <div class="container">
        <!-- Header con navegación unificada -->
    <header>
      <div class="header-content">
        <img src="../images/logo.png" alt="Logo AgroTechnova" class="logo">
        <h1>🏠 Panel Principal</h1>
        <div class="user-info">
          <span id="usuarioNombre">Administrador</span>
          <button onclick="cerrarSesion()" class="btn-logout">Cerrar Sesión</button>
        </div>
      </div>
      <nav>
        <a href="dashboard.html" class="active">Dashboard</a>
        <a href="proyectos.html" >Proyectos</a>
        <a href="usuarios.html" >Usuarios</a>
        <a href="agendaReuniones.html" >Agenda</a>
        
        <!-- Dropdown: Gestión Financiera y Recursos -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn" >
            Gestión Financiera
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="nav-dropdown-content">
            <a href="recursos.html">Recursos</a>
            <a href="presupuestos.html">Presupuestos</a>
            <a href="gastos.html">Gastos</a>
          </div>
        </div>
        
        <!-- Dropdown: Inventario y Proveedores -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn" >
            Inventario y Proveedores
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="nav-dropdown-content">
            <a href="proveedores.html">Proveedores</a>
            <a href="productos.html">Productos</a>
            <a href="inventario.html">Inventario</a>
          </div>
        </div>

        <!-- Dropdown: Reportes y Documentación -->
        <div class="nav-dropdown">
          <button class="nav-dropdown-btn">
            Reportes y Documentación
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="nav-dropdown-content">
            <a href="reportes.html">Reportes Financieros</a>
            <a href="proyectosFinalizados.html">Proyectos Finalizados</a>
            <a href="catalogo.html">Catálogo de Servicios</a>
          </div>
        </div>
      </nav>
    </header>

    <!-- Bienvenida -->
    <section style="background: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h2 style="color: #2e7d32; margin-bottom: 10px;">¡Bienvenido de nuevo! 👋</h2>
      <p style="color: #666;">Nos alegra tenerte de nuevo en AgroTechNova</p>
    </section>

    <!-- Funcionalidades Disponibles -->
    <section style="background: white; padding: 30px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h2 style="color: #2e7d32; margin-bottom: 20px;">🚀 Funcionalidades Disponibles</h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="dashboard-card" onclick="window.location.href='usuarios.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-users fa-3x" style="color: #2e7d32; margin-bottom: 15px;"></i>
          <h3 style="color: #2e7d32; margin-bottom: 10px;">Gestión de Usuarios</h3>
          <p style="color: #666; font-size: 14px;">Administra usuarios, roles y permisos del sistema</p>
        </div>
        
        <div class="dashboard-card" onclick="window.location.href='proyectos.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-project-diagram fa-3x" style="color: #2e7d32; margin-bottom: 15px;"></i>
          <h3 style="color: #2e7d32; margin-bottom: 10px;">Gestión de Proyectos</h3>
          <p style="color: #666; font-size: 14px;">Crea y administra proyectos, fases e hitos</p>
        </div>
        
        <div class="dashboard-card" onclick="window.location.href='agendaReuniones.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-calendar-check fa-3x" style="color: #2e7d32; margin-bottom: 15px;"></i>
          <h3 style="color: #2e7d32; margin-bottom: 10px;">Agenda de Reuniones</h3>
          <p style="color: #666; font-size: 14px;">Programa y gestiona reuniones del equipo</p>
        </div>
      </div>

      <h3 style="color: #2e7d32; margin-top: 30px; margin-bottom: 15px; border-top: 2px solid #e8f5e9; padding-top: 20px;">📊 Gestión Financiera y Recursos</h3>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
        <div class="dashboard-card" onclick="irARecursos()" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-tools fa-3x" style="color: #f57c00; margin-bottom: 15px;"></i>
          <h3 style="color: #f57c00; margin-bottom: 10px;">Recursos</h3>
          <p style="color: #666; font-size: 14px;">Gestiona recursos, materiales y equipos por proyecto</p>
        </div>
        
        <div class="dashboard-card" onclick="irAPresupuestos()" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-dollar-sign fa-3x" style="color: #f57c00; margin-bottom: 15px;"></i>
          <h3 style="color: #f57c00; margin-bottom: 10px;">Presupuestos</h3>
          <p style="color: #666; font-size: 14px;">Administra presupuestos y controla gastos</p>
        </div>
        
        <div class="dashboard-card" onclick="irAGastos()" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-receipt fa-3x" style="color: #f57c00; margin-bottom: 15px;"></i>
          <h3 style="color: #f57c00; margin-bottom: 10px;">Gastos</h3>
          <p style="color: #666; font-size: 14px;">Registra y monitorea gastos del proyecto</p>
        </div>
      </div>

      <h3 style="color: #2e7d32; margin-top: 30px; margin-bottom: 15px; border-top: 2px solid #e8f5e9; padding-top: 20px;">📦 Inventario y Proveedores</h3>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
        <div class="dashboard-card" onclick="window.location.href='proveedores.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-truck fa-3x" style="color: #1976d2; margin-bottom: 15px;"></i>
          <h3 style="color: #1976d2; margin-bottom: 10px;">Proveedores</h3>
          <p style="color: #666; font-size: 14px;">Gestiona proveedores y sus contactos</p>
        </div>
        
        <div class="dashboard-card" onclick="window.location.href='productos.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-box fa-3x" style="color: #1976d2; margin-bottom: 15px;"></i>
          <h3 style="color: #1976d2; margin-bottom: 10px;">Productos</h3>
          <p style="color: #666; font-size: 14px;">Administra catálogo de productos e insumos</p>
        </div>
        
        <div class="dashboard-card" onclick="window.location.href='inventario.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-warehouse fa-3x" style="color: #1976d2; margin-bottom: 15px;"></i>
          <h3 style="color: #1976d2; margin-bottom: 10px;">Inventario</h3>
          <p style="color: #666; font-size: 14px;">Registra entradas y salidas de inventario</p>
        </div>
      </div>

      <h3 style="color: #2e7d32; margin-top: 30px; margin-bottom: 15px; border-top: 2px solid #e8f5e9; padding-top: 20px;">📊 Reportes y Documentación</h3>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
        <div class="dashboard-card" onclick="window.location.href='reportes.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-chart-pie fa-3x" style="color: #7b1fa2; margin-bottom: 15px;"></i>
          <h3 style="color: #7b1fa2; margin-bottom: 10px;">Reportes Financieros</h3>
          <p style="color: #666; font-size: 14px;">Genera reportes y exporta a PDF/Excel</p>
        </div>
        
        <div class="dashboard-card" onclick="window.location.href='proyectosFinalizados.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-check-circle fa-3x" style="color: #7b1fa2; margin-bottom: 15px;"></i>
          <h3 style="color: #7b1fa2; margin-bottom: 10px;">Proyectos Finalizados</h3>
          <p style="color: #666; font-size: 14px;">Visualiza el historial de proyectos completados</p>
        </div>
        
        <div class="dashboard-card" onclick="window.location.href='catalogo.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-book fa-3x" style="color: #7b1fa2; margin-bottom: 15px;"></i>
          <h3 style="color: #7b1fa2; margin-bottom: 10px;">Catálogo de Servicios</h3>
          <p style="color: #666; font-size: 14px;">Explora nuestros servicios y soluciones</p>
        </div>
      </div>

      <h3 style="color: #2e7d32; margin-top: 30px; margin-bottom: 15px; border-top: 2px solid #e8f5e9; padding-top: 20px;">🛠️ Administración del Sistema</h3>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
        <div class="dashboard-card" onclick="window.location.href='soporte.html'" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-headset fa-3x" style="color: #c2185b; margin-bottom: 15px;"></i>
          <h3 style="color: #c2185b; margin-bottom: 10px;">Soporte</h3>
          <p style="color: #666; font-size: 14px;">Gestión de tickets y solicitudes de soporte</p>
        </div>
        
        <div class="dashboard-card" onclick="verificarAccesoAdmin('panelAdmin.html')" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-chart-line fa-3x" style="color: #c2185b; margin-bottom: 15px;"></i>
          <h3 style="color: #c2185b; margin-bottom: 10px;">Panel Administrativo</h3>
          <p style="color: #666; font-size: 14px;">Métricas y estadísticas del sistema (Solo Admin)</p>
        </div>
        
        <div class="dashboard-card" onclick="verificarAccesoAdmin('actividad.html')" style="cursor: pointer; padding: 30px; background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); border-radius: 10px; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <i class="fas fa-history fa-3x" style="color: #c2185b; margin-bottom: 15px;"></i>
          <h3 style="color: #c2185b; margin-bottom: 10px;">Actividad del Sistema</h3>
          <p style="color: #666; font-size: 14px;">Visualización de logs y eventos (Solo Admin)</p>
        </div>
      </div>
    </section>

    <!-- Mensaje Institucional -->
    <section style="background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%); padding: 30px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); color: white; text-align: center;">
      <h2 style="margin-bottom: 15px;">💡 Innovación para el campo</h2>
      <p style="margin-bottom: 10px; line-height: 1.6;">En AgroTechNova impulsamos el desarrollo agroindustrial mediante tecnología, asesoría y proyectos sostenibles que buscan mejorar la productividad y el bienestar de las comunidades rurales.</p>
      <p style="line-height: 1.6;">Nuestro equipo de expertos está listo para ayudarte a planificar, gestionar y optimizar tus proyectos agroindustriales.</p>
    </section>

  </div>

  <style>
    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }
  </style>

  <script>
    // Obtener datos del usuario desde localStorage
    const nombreUsuario = localStorage.getItem('nombreUsuario') || 'Usuario';
    const rolUsuario = localStorage.getItem('rolUsuario') || 'productor';
    
    // La función cerrarSesion() está ahora en header.js

    // Funciones de navegación para Sprint 3
    async function irARecursos() {
      const proyectoId = await obtenerPrimerProyecto();
      if (proyectoId) {
        window.location.href = `recursos.html?proyecto_id=${proyectoId}`;
      } else {
        alert('No tienes proyectos disponibles. Por favor crea un proyecto primero.');
        window.location.href = 'proyectos.html';
      }
    }

    async function irAPresupuestos() {
      const proyectoId = await obtenerPrimerProyecto();
      if (proyectoId) {
        window.location.href = `presupuestos.html?proyecto_id=${proyectoId}`;
      } else {
        alert('No tienes proyectos disponibles. Por favor crea un proyecto primero.');
        window.location.href = 'proyectos.html';
      }
    }

    async function irAGastos() {
      const proyectoId = await obtenerPrimerProyecto();
      if (proyectoId) {
        window.location.href = `gastos.html?proyecto_id=${proyectoId}`;
      } else {
        alert('No tienes proyectos disponibles. Por favor crea un proyecto primero.');
        window.location.href = 'proyectos.html';
      }
    }

    async function obtenerPrimerProyecto() {
      try {
        const response = await fetch('/api/projects');
        if (response.ok) {
          const data = await response.json();
          if (data.projects && data.projects.length > 0) {
            return data.projects[0].id;
          }
        }
      } catch (error) {
        console.error('Error al obtener proyectos:', error);
      }
      return null;
    }

    // Función para verificar acceso de administrador (Sprint 6)
    async function verificarAccesoAdmin(pagina) {
      try {
        // Verificar sesión en el servidor
        const response = await fetch('/api/auth/session', {
          method: 'GET',
          credentials: 'include'
        });

        const data = await response.json();
        
        console.log('🔍 verificarAccesoAdmin - Response data:', data);
        console.log('🔍 data.authenticated:', data.authenticated);
        console.log('🔍 data.user:', data.user);
        console.log('🔍 data.user?.rol:', data.user?.rol);

        if (data.authenticated && data.user && data.user.rol === 'administrador') {
          // Usuario autenticado y es admin
          console.log('✅ Acceso permitido, redirigiendo a:', pagina);
          window.location.href = pagina;
        } else {
          // No es admin o no está autenticado
          const rolActual = data.user?.rol || localStorage.getItem('rolUsuario') || 'No definido';
          console.log('❌ Acceso denegado. Rol actual:', rolActual);
          alert('⚠️ Acceso Denegado\n\nEsta funcionalidad está disponible solo para administradores del sistema.\n\nTu rol actual es: ' + rolActual);
        }
      } catch (error) {
        console.error('Error al verificar acceso:', error);
        alert('⚠️ Error al verificar permisos. Por favor, inicia sesión nuevamente.');
        window.location.href = 'login.html';
      }
    }
  </script>
  <script>
    // Funcionalidad de dropdowns
    document.addEventListener('DOMContentLoaded', function() {
      const dropdownButtons = document.querySelectorAll('.nav-dropdown-btn');
      
      dropdownButtons.forEach(btn => {
        btn.addEventListener('click', function(e) {
          e.stopPropagation();
          const dropdown = this.parentElement;
          const isOpen = dropdown.classList.contains('open');
          
          // Cerrar todos los dropdowns
          document.querySelectorAll('.nav-dropdown').forEach(dd => {
            dd.classList.remove('open');
          });
          
          // Abrir/cerrar el dropdown actual
          if (!isOpen) {
            dropdown.classList.add('open');
          }
        });
      });
      
      // Cerrar dropdowns al hacer clic fuera
      document.addEventListener('click', function() {
        document.querySelectorAll('.nav-dropdown').forEach(dd => {
          dd.classList.remove('open');
        });
      });
    });

    // Función de cierre de sesión
    function cerrarSesion() {
      fetch('/api/auth/logout', {
        method: 'POST',
        credentials: 'include'
      }).then(() => {
        localStorage.removeItem('nombreUsuario');
        localStorage.removeItem('emailUsuario');
        localStorage.removeItem('rolUsuario');
        window.location.href = 'login.html';
      }).catch(() => {
        localStorage.removeItem('nombreUsuario');
        localStorage.removeItem('emailUsuario');
        localStorage.removeItem('rolUsuario');
        window.location.href = 'login.html';
      });
    }
  </script>

</html>


